<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Cartillas de Bingo</title>
    <!-- LibrerÃ­a para generaciÃ³n de PDF, con defer -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    <style>
        /* ... (igual que antes: tu CSS sin cambios) ... */
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Generador de Cartillas de Bingo</h1>
        
        <div class="form-group">
            <label for="squares">ğŸ”¢ NÃºmero de cuadrados por cartilla:</label>
            <input type="number" id="squares" min="4" max="25" value="9">
        </div>

        <div class="form-group">
            <label for="cards">ğŸ“„ NÃºmero de cartillas:</label>
            <input type="number" id="cards" min="1" max="20" value="4">
        </div>

        <!-- Botones ahora con id en lugar de onclick inline -->
        <button id="editBtn" class="button btn-secondary">
            <span class="icon">âœï¸</span> Editar Frases
        </button>

        <button id="downloadBtn" class="button btn-success">
            <span class="icon">â¬‡ï¸</span> Descargar Cartillas
        </button>
    </div>

    <div id="phrasesModal" class="modal">
        <div class="modal-content">
            <span id="closeModalBtn" class="close">&times;</span>
            <h2>ğŸ“ Editar Frases del Bingo</h2>
            <div id="phrasesContainer" class="phrases-container"></div>
            <button id="addPhraseBtn" class="button btn-success">
                <span class="icon">â•</span> AÃ±adir Frase
            </button>
            <button id="saveCloseBtn" class="button btn-primary">
                <span class="icon">ğŸ’¾</span> Guardar y Cerrar
            </button>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Frases por defecto
        let phrases = [
            "Tiene 2 hermanos","NaciÃ³ en octubre","Su comida favorita es la pizza","Le gusta el fÃºtbol",
            "Tiene una mascota","Su color favorito es el azul","Practica algÃºn deporte","Le gusta leer libros",
            "Sabe tocar un instrumento","Ha viajado a otro paÃ­s","Le gusta cocinar","Le gusta tener plantas",
            "Su pelÃ­cula favorita es de acciÃ³n","Le gusta la mÃºsica pop","Sabe bailar","Tiene hermanos mayores",
            "Su materia favorita es matemÃ¡ticas","Le gusta levantarse temprano","Prefiere el verano al invierno",
            "Ha estado en un concierto","Le gusta el chocolate","Sabe nadar","Tiene ojos marrones",
            "Su nÃºmero favorito es el 7","Le gusta ver series","Ha montado en aviÃ³n","Prefiere los gatos a los perros",
            "Le gusta la playa","Sabe montar en bicicleta","Su dÃ­a favorito es el viernes","Le gusta la comida picante",
            "Ha jugado videojuegos hoy","Tiene el pelo rizado","Le gusta dibujar","Sabe patinar",
            "Su estaciÃ³n favorita es primavera","Le gusta madrugar","Ha leÃ­do un libro este mes",
            "Prefiere dulce a salado","Le gusta hacer ejercicio","Su bebida favorita es el agua",
            "Le gusta ir al cine","Sabe jugar ajedrez","Su hobby favorito es la fotografÃ­a",
            "Le gusta la montaÃ±a","Ha estado en un museo","Prefiere tÃ© a cafÃ©","Le gusta escribir",
            "Su animal favorito es el leÃ³n"
        ];

        let availablePhrases = [];
        let usedPhrases = [];

        const editBtn        = document.getElementById('editBtn');
        const downloadBtn    = document.getElementById('downloadBtn');
        const addPhraseBtn   = document.getElementById('addPhraseBtn');
        const saveCloseBtn   = document.getElementById('saveCloseBtn');
        const closeModalBtn  = document.getElementById('closeModalBtn');
        const modal          = document.getElementById('phrasesModal');
        const phrasesContainer = document.getElementById('phrasesContainer');

        function openModal() {
            loadPhrases();
            modal.style.display = 'block';
        }
        function closeModal() {
            modal.style.display = 'none';
        }

        function loadPhrases() {
            phrasesContainer.innerHTML = '';
            phrases.forEach((phrase, idx) => {
                const row = document.createElement('div');
                row.style.display = 'flex';
                row.style.alignItems = 'center';
                row.style.gap = '10px';

                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'phrase-input';
                input.value = phrase;
                input.dataset.index = idx;
                input.style.flex = '1';

                const del = document.createElement('button');
                del.textContent = 'ğŸ—‘ï¸';
                Object.assign(del.style, {
                    background: '#ff4757', color: 'white',
                    border: 'none', borderRadius: '5px',
                    padding: '5px 10px', cursor: 'pointer'
                });
                del.addEventListener('click', () => {
                    phrases.splice(idx, 1);
                    loadPhrases();
                });

                row.append(input, del);
                phrasesContainer.append(row);
            });
        }

        function addPhrase() {
            const row = document.createElement('div');
            Object.assign(row.style, { display: 'flex', alignItems: 'center', gap: '10px' });

            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'phrase-input';
            input.placeholder = 'Escribe una nueva frase aquÃ­...';
            input.style.flex = '1';

            const del = document.createElement('button');
            del.textContent = 'ğŸ—‘ï¸';
            Object.assign(del.style, {
                background: '#ff4757', color: 'white',
                border: 'none', borderRadius: '5px',
                padding: '5px 10px', cursor: 'pointer'
            });
            del.addEventListener('click', () => row.remove());

            row.append(input, del);
            phrasesContainer.append(row);
            input.focus();
        }

        function saveAndClose() {
            const inputs = phrasesContainer.querySelectorAll('.phrase-input');
            phrases = Array.from(inputs)
                .map(i => i.value.trim())
                .filter(t => t.length);
            closeModal();
        }

        function shuffleArray(arr) {
            const a = [...arr];
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }

        function getUniquePhrases(count) {
            const sel = [];
            while (sel.length < count) {
                if (!availablePhrases.length) {
                    availablePhrases = shuffleArray(phrases.filter(p => !usedPhrases.includes(p)));
                    if (availablePhrases.length < count - sel.length) {
                        usedPhrases = [];
                        availablePhrases = shuffleArray([...phrases]);
                    }
                }
                const next = availablePhrases.shift();
                sel.push(next);
                usedPhrases.push(next);
            }
            return sel;
        }

        function generateBingo() {
            const squares = +document.getElementById('squares').value;
            const cards   = +document.getElementById('cards').value;
            if (squares < 4 || squares > 25)
                return alert('El nÃºmero de cuadrados debe estar entre 4 y 25');
            if (cards < 1 || cards > 100)
                return alert('El nÃºmero de cartillas debe estar entre 1 y 100');
            if (!phrases.length)
                return alert('Necesitas al menos una frase para generar las cartillas');

            const perSide = Math.ceil(Math.sqrt(squares));
            const temp = document.createElement('div');
            availablePhrases = shuffleArray([...phrases]);
            usedPhrases = [];

            let pageDiv;
            for (let i = 0; i < cards; i++) {
                if (i % 4 === 0) {
                    pageDiv = document.createElement('div');
                    Object.assign(pageDiv.style, {
                        width: '297mm', height: '210mm',
                        padding: '10mm', boxSizing: 'border-box',
                        display: 'flex', flexWrap: 'wrap',
                        justifyContent: 'space-between',
                        alignContent: 'space-between',
                        background: 'white', overflow: 'hidden'
                    });
                    if (i + 4 < cards) pageDiv.style.pageBreakAfter = 'always';
                    temp.append(pageDiv);
                }

                const card = document.createElement('div');
                Object.assign(card.style, {
                    width: '48%', height: '48%',
                    border: '2px solid #000',
                    boxSizing: 'border-box',
                    display: 'flex', flexDirection: 'column'
                });

                const title = document.createElement('div');
                title.textContent = `BINGO - Cartilla ${i + 1}`;
                Object.assign(title.style, {
                    textAlign: 'center', fontWeight: 'bold',
                    marginBottom: '4px', fontSize: '10px'
                });
                card.append(title);

                const grid = document.createElement('div');
                grid.style.display = 'grid';
                grid.style.gridTemplateColumns = `repeat(${perSide},1fr)`;
                grid.style.flexGrow = '1';

                const phrasesForCard = getUniquePhrases(squares);
                phrasesForCard.forEach(text => {
                    const cell = document.createElement('div');
                    Object.assign(cell.style, {
                        background: '#fff',
                        border: '1px solid #000',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: '12px',
                        padding: '2px',
                        wordWrap: 'break-word',
                        minHeight: '20px',
                        textAlign: 'center'
                    });
                    cell.textContent = text;
                    grid.append(cell);
                });

                card.append(grid);
                pageDiv.append(card);
            }

            html2pdf()
                .set({
                    margin: 0,
                    filename: 'cartillas-bingo.pdf',
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
                })
                .from(temp)
                .save();
        }

        // Asignamos todos los event listeners
        editBtn.addEventListener('click', openModal);
        closeModalBtn.addEventListener('click', closeModal);
        window.addEventListener('click', e => {
            if (e.target === modal) closeModal();
        });
        addPhraseBtn.addEventListener('click', addPhrase);
        saveCloseBtn.addEventListener('click', saveAndClose);
        downloadBtn.addEventListener('click', generateBingo);
    });
    </script>
</body>
</html>
